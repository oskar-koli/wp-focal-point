(function(o){typeof define=="function"&&define.amd?define(o):o()})(function(){"use strict";var h=Object.defineProperty;var p=(o,i,n)=>i in o?h(o,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[i]=n;var s=(o,i,n)=>(p(o,typeof i!="symbol"?i+"":i,n),n);const o="";function i(){let r=document.querySelector(".focal-point__button");r&&r.addEventListener("click",function(c){c.preventDefault(),document.querySelector("focal-point-modal").open()})}window.addEventListener("koli_focal_point_init",i);class n extends HTMLElement{constructor(){super();s(this,"handleClose",()=>{this.classList.remove("open");let t=document.querySelector(".focal-point");this.remove(),t.append(this)});s(this,"handleSave",()=>{this.handleClose();var t=new Event("change",{bubbles:!0});this.focalPointInputTop.dispatchEvent(t)});s(this,"cursorDragStart",t=>{this.cursor.classList.add("dragging"),this.dragging=!0;let e=this.cursor.getBoundingClientRect();this.offsetX=t.pageX-(e.x+e.width/2),this.offsetY=t.pageY-(e.y+e.height/2),this.updateCursorPosition(t),document.body.addEventListener("mouseup",this.cursorDragEnd,{once:!0})});s(this,"cursorDragEnd",()=>{this.cursor.classList.remove("dragging"),this.dragging=!1});s(this,"cursorDrag",t=>{this.dragging&&this.updateCursorPosition(t)});s(this,"updateCursorPosition",t=>{let e=this.preview.getBoundingClientRect(),u=t.pageX-e.x,d=t.pageY-e.y,a=Math.min(e.width,Math.max(0,u-this.offsetX))/e.width,l=Math.min(e.height,Math.max(0,d-this.offsetY))/e.height;this.cursor.style.top=`${l*100}%`,this.cursor.style.left=`${a*100}%`,this.focalPointValue.innerHTML=`${Math.round(a*1e3)/10}% x ${Math.round(l*1e3)/10}%`,this.focalPointInputLeft.setAttribute("value",`${a}`),this.focalPointInputTop.setAttribute("value",`${l}`)})}connectedCallback(){this.preview=this.querySelector(".focal-point-preview"),this.cursor=this.querySelector(".focal-point-preview__cursor"),this.focalPointValue=document.querySelector(".focal-point__value"),this.focalPointInputLeft=document.querySelector(".koli_image_focus_left"),this.focalPointInputTop=document.querySelector(".koli_image_focus_top"),this.saveButton=this.querySelector(".focal-point-modal__btn-save");let t=parseFloat(this.focalPointInputLeft.getAttribute("value")),e=parseFloat(this.focalPointInputTop.getAttribute("value"));this.cursor.style.left=`${t*100}%`,this.cursor.style.top=`${e*100}%`,this.cursor.addEventListener("mousedown",this.cursorDragStart),document.body.addEventListener("mousemove",this.cursorDrag),this.saveButton.addEventListener("click",this.handleSave)}open(){this.classList.add("open"),this.parentElement.nodeName!=="BODY"&&(this.remove(),document.body.append(this))}disconnectedCallback(){document.body.removeEventListener("mousemove",this.cursorDrag)}}customElements.define("focal-point-modal",n)});
